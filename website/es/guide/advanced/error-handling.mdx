# Manejo de Errores

Aprende cómo manejar errores con gracia en Bloque Payments.

## Tipos de Errores

Bloque Payments puede devolver diferentes tipos de errores:

- **Errores de validación**: Datos de entrada inválidos
- **Errores de autenticación**: Access token inválido o faltante
- **Errores de pago**: Fallos en el procesamiento de pagos
- **Errores de red**: Problemas de conexión

## Manejo de Errores en Frontend

Usa el callback `onError` para manejar errores en el componente React:

```tsx
import { init, BloqueCheckout } from '@bloque/payments-react';

init({
  publicApiKey: 'pk_live_...',
  mode: 'production',
});

function CheckoutPage({ checkoutId }) {
  return (
    <BloqueCheckout
      checkoutId={checkoutId}
      onSuccess={(data) => {
        console.log('¡Pago exitoso!', data.payment_id);
        window.location.href = '/success';
      }}
      onError={(error) => {
        console.error('Pago fallido:', error);

        // Mostrar mensaje amigable para el usuario
        alert(`Pago fallido: ${error}`);
      }}
      onPending={(data) => {
        console.log('Pago pendiente:', data.payment_id);
        window.location.href = '/pending';
      }}
    />
  );
}
```

## Manejo de Errores en Backend

Maneja errores al crear checkouts:

```typescript
import { Bloque } from '@bloque/payments';
import express from 'express';

const app = express();
app.use(express.json());

const bloque = new Bloque({
  accessToken: process.env.BLOQUE_ACCESS_TOKEN!,
  mode: 'production',
});

app.post('/api/create-checkout', async (req, res) => {
  try {
    const checkout = await bloque.checkout.create({
      name: req.body.name,
      items: req.body.items,
      success_url: req.body.success_url,
    });

    res.json({ id: checkout.id, url: checkout.url });
  } catch (error) {
    console.error('Error de checkout:', error);

    // Determinar tipo de error
    if (error.status === 400) {
      return res.status(400).json({
        success: false,
        error: 'Datos de checkout inválidos',
        message: error.message,
      });
    }

    if (error.status === 401) {
      return res.status(401).json({
        success: false,
        error: 'No autorizado',
        message: 'Access token inválido',
      });
    }

    // Error genérico
    res.status(500).json({
      success: false,
      error: 'Error interno del servidor',
    });
  }
});

app.listen(3000);
```

## Códigos de Error Comunes

### Errores de Tarjeta

- `card_declined`: Tarjeta rechazada
- `insufficient_funds`: Fondos insuficientes
- `invalid_card_number`: Número de tarjeta inválido
- `invalid_expiry`: Fecha de vencimiento inválida
- `invalid_cvv`: Código de seguridad inválido

### Errores Generales

- `invalid_amount`: Monto de pago inválido
- `invalid_currency`: Moneda no soportada
- `expired_checkout`: Sesión de checkout expirada

## Mensajes Amigables para el Usuario

Proporciona mensajes de error claros y accionables:

```typescript
function getErrorMessage(errorCode: string): string {
  switch (errorCode) {
    case 'card_declined':
      return 'Tu tarjeta fue rechazada. Por favor intenta otro método de pago o contacta a tu banco.';

    case 'insufficient_funds':
      return 'Tu tarjeta tiene fondos insuficientes. Por favor intenta otra tarjeta.';

    case 'invalid_card_number':
      return 'El número de tarjeta que ingresaste es inválido. Por favor verifica e intenta de nuevo.';

    case 'expired_card':
      return 'Tu tarjeta ha expirado. Por favor usa una tarjeta diferente.';

    case 'invalid_cvv':
      return 'El código de seguridad (CVV) que ingresaste es inválido.';

    case 'bank_unavailable':
      return 'El banco seleccionado no está disponible temporalmente. Por favor intenta más tarde.';

    case 'expired_checkout':
      return 'La sesión de pago ha expirado. Por favor inicia una nueva.';

    default:
      return 'El pago falló. Por favor intenta de nuevo o contacta a soporte.';
  }
}
```

## Próximos Pasos

- [Webhooks](/pay/guide/webhooks/setup) - Maneja eventos de pago
- [Métodos de Pago](/pay/guide/payments/methods) - Aprende sobre los métodos de pago
