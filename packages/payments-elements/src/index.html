<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bloque Payments - Checkout</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f9fafb;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      padding: 32px;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    h1 {
      text-align: center;
      color: #111827;
      margin-top: 0;
    }
    .payment-info {
      background: #f0fdf4;
      border: 1px solid #86efac;
      border-radius: 8px;
      padding: 16px;
      margin-top: 24px;
    }
    .payment-info h3 {
      margin: 0 0 8px 0;
      color: #166534;
    }
    .payment-info pre {
      background: white;
      padding: 12px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸš€ Bloque Payments</h1>

    <!-- Ejemplo 1: Modo automÃ¡tico -->
    <h2 style="margin-top: 32px; font-size: 16px; color: #6b7280;">Ejemplo 1: Modo AutomÃ¡tico (envÃ­o directo al API)</h2>
    <bloque-checkout id="checkout1"></bloque-checkout>

    <div class="payment-info" id="paymentInfo1" style="display: none;">
      <h3>âœ… Pago procesado exitosamente</h3>
      <pre id="paymentData1"></pre>
    </div>

    <!-- Ejemplo 2: Modo manual -->
    <h2 style="margin-top: 48px; font-size: 16px; color: #6b7280;">Ejemplo 2: Modo Manual (custom onSubmit)</h2>
    <bloque-checkout id="checkout2"></bloque-checkout>

    <div class="payment-info" id="paymentInfo2" style="display: none;">
      <h3>âœ… Datos de pago recibidos</h3>
      <pre id="paymentData2"></pre>
    </div>

    <!-- Ejemplo 3: Tarjeta y PSE con labels en inglÃ©s -->
    <h2 style="margin-top: 48px; font-size: 16px; color: #6b7280;">Ejemplo 3: Tarjeta y PSE (labels en inglÃ©s)</h2>
    <bloque-checkout id="checkout3"></bloque-checkout>

    <div class="payment-info" id="paymentInfo3" style="display: none;">
      <h3>âœ… Datos de pago recibidos</h3>
      <pre id="paymentData3"></pre>
    </div>
  </div>

  <script type="module">
    // Configurar ejemplo 1: Modo automÃ¡tico (envÃ­o directo al API)
    const checkout1 = document.getElementById('checkout1');
    const paymentInfo1 = document.getElementById('paymentInfo1');
    const paymentData1 = document.getElementById('paymentData1');

    checkout1.config = {
      payment_methods: ['card', 'pse', 'cash'],
      amount: 50000,
      currency: 'COP',
      webhookUrl: 'https://myapp.com/webhooks/payment' // Opcional
    };

    // Sin onSubmit = Modo automÃ¡tico (envÃ­a directamente al API)

    // Usar onSuccess y onError en lugar de eventos
    checkout1.onSuccess = (response) => {
      console.log('Payment 1 success!');
      console.log('Payment ID:', response.id);
      paymentData1.textContent = JSON.stringify(response, null, 2);
      paymentInfo1.style.display = 'block';
      paymentInfo1.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    };

    checkout1.onError = (error) => {
      console.error('Payment 1 error:', error.message);
      alert(`Error: ${error.message}`);
    };

    // Configurar ejemplo 2: Modo manual (custom onSubmit)
    const checkout2 = document.getElementById('checkout2');
    const paymentInfo2 = document.getElementById('paymentInfo2');
    const paymentData2 = document.getElementById('paymentData2');

    checkout2.config = {
      payment_methods: ['card'],
      amount: 120000,
      currency: 'COP'
    };

    // Modo manual: proporcionar funciÃ³n onSubmit personalizada
    checkout2.onSubmit = async ({ data, type }) => {
      console.log('Procesando pago manualmente:', { data, type });

      // Enviar a tu backend
      const response = await fetch('https://mybackend.com/process-payment', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ data, type })
      });

      if (!response.ok) {
        throw new Error('Payment processing failed');
      }

      // IMPORTANTE: Retornar la respuesta del API de Bloque
      // Tu backend debe devolver el objeto con el ID del pago
      const paymentResponse = await response.json();
      return paymentResponse; // { id: 'pay_xxx', status: 'success', ... }
    };

    checkout2.onSuccess = (response) => {
      console.log('Payment 2 success!');
      console.log('Payment ID:', response.id);
      paymentData2.textContent = JSON.stringify(response, null, 2);
      paymentInfo2.style.display = 'block';
      paymentInfo2.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    };

    checkout2.onError = (error) => {
      console.error('Payment 2 error:', error.message);
      alert(`Error: ${error.message}`);
    };

    // Configurar ejemplo 3: Tarjeta y PSE (con labels en inglÃ©s)
    const checkout3 = document.getElementById('checkout3');
    const paymentInfo3 = document.getElementById('paymentInfo3');
    const paymentData3 = document.getElementById('paymentData3');

    checkout3.config = {
      payment_methods: ['card', 'pse'],
      amount: 250000,
      currency: 'COP',
      labels: {
        card: {
          cardNumber: 'Card Number',
          cardNumberPlaceholder: '1234 5678 9012 3456',
          cardholderName: 'Cardholder Name',
          cardholderNamePlaceholder: 'JOHN DOE',
          expiryDate: 'Expiry Date',
          expiryDatePlaceholder: 'MM/YY',
          cvv: 'CVV',
          cvvPlaceholder: '123',
          email: 'Email',
          emailPlaceholder: 'example@email.com',
          submitButton: 'Pay'
        }
      }
    };

    checkout3.onSuccess = (response) => {
      console.log('Payment 3 success!');
      console.log('Payment ID:', response.id);
      paymentData3.textContent = JSON.stringify(response, null, 2);
      paymentInfo3.style.display = 'block';
      paymentInfo3.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    };

    checkout3.onError = (error) => {
      console.error('Payment 3 error:', error.message);
      alert(`Error: ${error.message}`);
    };
  </script>
</body>
</html>
